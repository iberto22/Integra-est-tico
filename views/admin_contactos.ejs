<%- include('../templates/head') %>
<link rel="stylesheet" href="/static/css/admin_contactos.css">

<section class="admin container">
  <% if (!authenticated) { %>
    <h1>Acceso Admin</h1>
    <% if (error) { %><div class="alert"> <%= error %> </div><% } %>
    <form action="/admin" method="post">
      <label>Usuario<br/><input name="user" required></label>
      <label>Contraseña<br/><input name="pass" type="password" required></label>
      <button class="btn primary" type="submit">Entrar</button>
    </form>
  <% } else { %>
    <h1>Contactos registrados</h1>
    <table class="contacts-table">
      <thead><tr><th>Nombre</th><th>Email</th><th>Tel</th><th>Mensaje</th><th>Fecha</th><th>Acciones</th></tr></thead>
      <tbody>
        <% (contacts||[]).forEach(function(c){ %>
          <tr>
            <td><%= c.name %></td>
            <td><%= c.email %></td>
            <td><%= c.phone %></td>
            <td><%= c.message %></td>
            <td><%= new Date(c.date).toLocaleString() %></td>
            <td>
              <form method="post" action="/admin/contactos/delete/<%= c.id %>" onsubmit="return confirm('Borrar?')">
                <button class="btn danger" type="submit">Borrar</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>

    <form action="/admin" method="post" style="margin-top:20px;">
      <button class="btn outline" type="submit" name="logout" value="1">Cerrar sesión</button>
    </form>
  <% } %>
</section>

<%- include('../templates/footer') %>
